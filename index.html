<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="tberrq2w_BrhcvBXoMjM8tHwcZEVkonogQprQiu91wk" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="TempMonkeyMail - Free Disposable Email Tool">
  <title>TempMonkeyMail</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background-color: #f8fafc;
    }
    .email-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .main-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .email-input {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .email-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .btn-secondary {
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      transition: all 0.2s ease;
    }
    .btn-secondary:hover {
      background: #e2e8f0;
    }
    .email-item {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .email-item:hover {
      border-color: #667eea;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .email-item.unread {
      border-left: 4px solid #667eea;
      background: #f8fafc;
    }
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="email-container">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">üêí TempMonkeyMail</h1>
        <p class="text-white/80">Free Temporary Email Service</p>
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto">
        <div class="main-card p-6 mb-6">
          <!-- Email Generation Section -->
          <div class="mb-6">
            <div class="flex items-center space-x-4">
              <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 mb-2">Your Temporary Email Address</label>
                <div class="relative">
                  <input 
                    type="text" 
                    id="emailAddress" 
                    readonly 
                    placeholder="Click 'Generate Email' to create your temporary email"
                    class="email-input w-full px-4 py-3 text-gray-700 font-mono text-sm focus:outline-none"
                  >
                  <button 
                    onclick="copyEmail()" 
                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                    title="Copy to clipboard"
                  >
                    üìã
                  </button>
                </div>
              </div>
              <div class="flex space-x-2">
                <button 
                  onclick="generateEmail()" 
                  id="generateBtn"
                  class="btn-primary text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2"
                >
                  <span id="generateText">Generate Email</span>
                  <span id="generateIcon">‚ú®</span>
                </button>
                <button 
                  onclick="refreshInbox()" 
                  id="refreshBtn"
                  class="btn-secondary text-gray-700 px-4 py-3 rounded-lg font-medium flex items-center space-x-2"
                  disabled
                >
                  <span id="refreshIcon">üîÑ</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Stats Section -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-blue-50 p-4 rounded-lg">
              <div class="text-2xl font-bold text-blue-600" id="totalEmails">0</div>
              <div class="text-sm text-blue-600">Total Emails</div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <div class="text-2xl font-bold text-green-600" id="unreadEmails">0</div>
              <div class="text-sm text-green-600">Unread</div>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg">
              <div class="text-2xl font-bold text-purple-600" id="emailAge">0m</div>
              <div class="text-sm text-purple-600">Email Age</div>
            </div>
          </div>
        </div>

        <!-- Inbox Section -->
        <div class="main-card p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Inbox</h2>
            <div class="flex items-center space-x-4">
              <span class="text-sm text-gray-500" id="lastRefresh">Never refreshed</span>
              <button 
                onclick="toggleAutoRefresh()" 
                id="autoRefreshBtn"
                class="text-sm text-blue-600 hover:text-blue-700"
              >
                Auto-refresh: <span id="autoRefreshStatus">Off</span>
              </button>
            </div>
          </div>
          
          <div id="inbox" class="space-y-3">
            <div class="text-center py-12 text-gray-500">
              <div class="text-6xl mb-4">üì¨</div>
              <p class="text-lg mb-2">No emails yet</p>
              <p class="text-sm">Generate an email address to start receiving messages!</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-8 text-white/60 text-sm">
        <p>Secure ‚Ä¢ Anonymous ‚Ä¢ Free ‚Ä¢ No Registration Required</p>
      </div>
    </div>
  </div>

  <script>
    let token = "", address = "";
    let refreshInterval = null;
    let autoRefreshEnabled = false;
    let emailGeneratedTime = null;
    let unreadCount = 0;

    async function generateEmail() {
      const btn = document.getElementById('generateBtn');
      const text = document.getElementById('generateText');
      const icon = document.getElementById('generateIcon');
      
      // Show loading state
      btn.disabled = true;
      text.textContent = 'Generating...';
      icon.textContent = '‚è≥';
      icon.classList.add('loading-spinner');

      try {
        const res = await fetch("/api/generate");
        const data = await res.json();
        token = data.token;
        address = data.address;
        emailGeneratedTime = new Date();
        
        document.getElementById("emailAddress").value = address;
        
        // Enable refresh button
        document.getElementById('refreshBtn').disabled = false;
        
        // Load initial inbox
        await loadInbox();
        
        // Show success state
        text.textContent = 'Generated!';
        icon.textContent = '‚úÖ';
        icon.classList.remove('loading-spinner');
        
        setTimeout(() => {
          text.textContent = 'Generate New';
          icon.textContent = '‚ú®';
          btn.disabled = false;
        }, 1000);
        
        showNotification('Email address generated successfully!', 'success');
        
      } catch (error) {
        console.error('Error generating email:', error);
        text.textContent = 'Error!';
        icon.textContent = '‚ùå';
        icon.classList.remove('loading-spinner');
        
        setTimeout(() => {
          text.textContent = 'Generate Email';
          icon.textContent = '‚ú®';
          btn.disabled = false;
        }, 2000);
        
        showNotification('Failed to generate email. Please try again.', 'error');
      }
    }

    async function loadInbox() {
      if (!token) return;
      
      try {
        const res = await fetch(`/api/messages?token=${token}`);
        const messages = await res.json();
        const inbox = document.getElementById("inbox");
        
        updateStats(messages);
        updateLastRefresh();
        
        if (messages.length === 0) {
          inbox.innerHTML = `
            <div class="text-center py-12 text-gray-500">
              <div class="text-6xl mb-4">üì¨</div>
              <p class="text-lg mb-2">No emails yet</p>
              <p class="text-sm">Emails will appear here when received!</p>
            </div>
          `;
          return;
        }
        
        inbox.innerHTML = messages.map((msg, index) => `
          <div class="email-item p-4 ${index < unreadCount ? 'unread' : ''}" onclick="viewEmail('${msg.id}')">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center space-x-2 mb-1">
                  <span class="font-medium text-gray-900">${msg.subject || 'No Subject'}</span>
                  ${index < unreadCount ? '<span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">NEW</span>' : ''}
                </div>
                <div class="text-sm text-gray-600 mb-1">From: ${msg.from.address}</div>
                <div class="text-xs text-gray-500">${formatDate(msg.date)}</div>
                ${msg.text ? `<div class="text-sm text-gray-700 mt-2 line-clamp-2">${msg.text.substring(0, 150)}${msg.text.length > 150 ? '...' : ''}</div>` : ''}
              </div>
              <div class="text-2xl ml-4">üìß</div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Error loading inbox:', error);
        showNotification('Failed to load emails. Please try again.', 'error');
      }
    }

    function updateStats(messages) {
      document.getElementById('totalEmails').textContent = messages.length;
      document.getElementById('unreadEmails').textContent = unreadCount;
      
      if (emailGeneratedTime) {
        const age = Math.floor((new Date() - emailGeneratedTime) / 60000);
        document.getElementById('emailAge').textContent = `${age}m`;
      }
    }

    function updateLastRefresh() {
      const now = new Date();
      document.getElementById('lastRefresh').textContent = `Last refreshed: ${now.toLocaleTimeString()}`;
    }

    async function refreshInbox() {
      const btn = document.getElementById('refreshBtn');
      const icon = document.getElementById('refreshIcon');
      
      btn.disabled = true;
      icon.classList.add('loading-spinner');
      
      await loadInbox();
      
      icon.classList.remove('loading-spinner');
      btn.disabled = false;
      
      showNotification('Inbox refreshed!', 'success');
    }

    function toggleAutoRefresh() {
      autoRefreshEnabled = !autoRefreshEnabled;
      const status = document.getElementById('autoRefreshStatus');
      
      if (autoRefreshEnabled) {
        status.textContent = 'On';
        startAutoRefresh();
        showNotification('Auto-refresh enabled', 'success');
      } else {
        status.textContent = 'Off';
        stopAutoRefresh();
        showNotification('Auto-refresh disabled', 'info');
      }
    }

    function startAutoRefresh() {
      if (refreshInterval) {
        clearInterval(refreshInterval);
      }
      refreshInterval = setInterval(loadInbox, 10000); // Refresh every 10 seconds
    }

    function stopAutoRefresh() {
      if (refreshInterval) {
        clearInterval(refreshInterval);
        refreshInterval = null;
      }
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      return date.toLocaleDateString();
    }

    async function copyEmail() {
      if (!address) {
        showNotification('Generate an email first!', 'warning');
        return;
      }
      
      try {
        await navigator.clipboard.writeText(address);
        showNotification('Email copied to clipboard!', 'success');
      } catch (error) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = address;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Email copied to clipboard!', 'success');
      }
    }

    function viewEmail(emailId) {
      // This would open a modal or navigate to email detail view
      showNotification('Email detail view - coming soon!', 'info');
    }

    function showNotification(message, type = 'info') {
      // Remove existing notifications
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => notification.remove());
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification px-6 py-3 rounded-lg text-white font-medium ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Add keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'r':
              e.preventDefault();
              if (!document.getElementById('refreshBtn').disabled) {
                refreshInbox();
              }
              break;
            case 'g':
              e.preventDefault();
              if (!document.getElementById('generateBtn').disabled) {
                generateEmail();
              }
              break;
          }
        }
      });
    });
  </script>
</body>
</html>
